(function(e){function t(t){for(var a,i,n=t[0],l=t[1],c=t[2],d=0,p=[];d<n.length;d++)i=n[d],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&p.push(s[i][0]),s[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);u&&u(t);while(p.length)p.shift()();return o.push.apply(o,c||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],a=!0,n=1;n<r.length;n++){var l=r[n];0!==s[l]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var a={},s={app:0},o=[];function i(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=a,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var u=l;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";r("85ec")},"039a":function(e,t,r){"use strict";r("7174")},"2dad":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t),r.d(t,"eventBus",(function(){return xe}));r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container",attrs:{id:"app"}},[r("div",{attrs:{id:"header"}},[r("main-header")],1),r("router-view",{key:e.$route.hash})],1)},o=[],i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{"margin-bottom":"50px"}},[r("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"dark"}},[r("b-navbar-brand",{attrs:{type:"button"},on:{click:function(t){return e.goHome()}}},[e._v("Home")]),r("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),r("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[r("b-navbar-nav",{staticClass:"ml-auto"},[r("div",{staticClass:"form-inline"},[r("b-form-input",{staticClass:"mr-sm-2",attrs:{type:"search",size:"sm",placeholder:"Search..."},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.goChatRooms(t)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),r("div",{staticStyle:{"text-align":"right"}},[this.$store.getters.isLoggedin?r("b-nav-item-dropdown",{scopedSlots:e._u([{key:"button-content",fn:function(){return[r("img",{attrs:{src:e.profilePictureUrl,height:"40",width:"50",alt:"프로필"},on:{error:e.replaceByDefaultImg}})]},proxy:!0}],null,!1,2009729756)},[r("b-dropdown-item",[r("router-link",{attrs:{tag:"div",to:"/profile"}},[e._v("프로필")])],1),r("b-dropdown-item",{on:{click:function(t){return e.logout()}}},[e._v("로그아웃")])],1):r("b-navbar-nav",[r("b-nav-item",[r("router-link",{attrs:{tag:"span",to:"/signup"}},[e._v("회원가입")])],1),r("b-nav-item",[r("router-link",{attrs:{tag:"span",to:"/login"}},[e._v("로그인")])],1)],1)],1)])],1)],1)],1)},n=[],l=(r("b0c0"),r("2b3d"),r("d3b7"),r("3ca3"),r("ddb0"),r("466d"),r("ac1f"),r("4d63"),r("25f0"),r("5319"),r("bc3a")),c=r.n(l),u=c.a.create({timeout:6e3}),d={signup:function(e,t,r,a){var s=new URLSearchParams;return s.append("memberId",e),s.append("password",t),s.append("name",r),s.append("email",a),u.post("/v1/members",s)},login:function(e,t){var r=new URLSearchParams;return r.append("memberId",e),r.append("password",t),u.post("/v1/auth/login",r)},logout:function(){return u.post("/v1/auth/logout")},authMe:function(){return u.get("/v1/auth/me")},refresh:function(){return u.post("/v1/auth/refresh")},getMemberInfo:function(e){return u.get("/v1/members/"+e)},getProfilePicture:function(e){return u.get("/v1/profilePicture/"+e)},registerProfilePicture:function(e){return u.post("/v1/profilePicture",e,{headers:{"Content-Type":"multipart/form-data"}})},deleteProfilePicture:function(){return u.delete("/v1/profilePicture")},existsParticipant:function(e){var t=new URLSearchParams;return t.append("roomId",e),u.get("/v1/chat/rooms/"+e+"/participant/exist")},searchRooms:function(e,t,r,a,s,o){var i=new URLSearchParams;return i.append("searchType",e),i.append("keyword",t),i.append("page",r),i.append("size",a),i.append("sort",s+","+o),u.get("/v1/chat/rooms",{params:i})},enterRoom:function(e){location.href="/chat/rooms/"+e},leaveRoom:function(e){return u.post("/v1/chat/rooms/"+e+"/leave")},createRoom:function(e){var t=new URLSearchParams;return t.append("title",e),u.post("/v1/chat/rooms",t)},getParticipants:function(e){return u.get("/v1/chat/rooms/"+e+"/participants")},getMessages:function(e,t,r,a){var s=new URLSearchParams;return r&&s.append("type",r),t&&s.append("date",t),a&&s.append("size",a),u.get("/v1/chat/rooms/"+e+"/messages",{params:s})},getLastReadMessage:function(e){return u.get("/v1/chat/rooms/"+e+"/messages/lastRead")},uploadFile:function(e){return u.post("/v1/chat/upload",e,{headers:{"Content-Type":"multipart/form-data"}})},sendMessage:function(e,t,r){var a=new URLSearchParams;return a.append("roomId",e),a.append("type",t),a.append("message",r),u.post("/v1/chat/rooms/"+e+"/messages/send",a)},getCookieValue:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}};function p(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}u.interceptors.request.use((function(e){var t=p("access_token");return e.headers.Authorization="Bearer "+t,e}),(function(e){return Promise.reject(e)})),u.interceptors.response.use((function(e){return e}),(function(e){return e.response&&"UNAUTHORIZED"==e.response.data.code&&!e.config._isRetry?(e.config._isRetry=!0,console.log("로그인이 필요합니다."),c.a.post("/v1/auth/refresh").then((function(t){console.log("리프레시 성공");var r=p("access_token");return e.config.headers.Authorization="Bearer "+r,c()(e.config)})).catch((function(e){return console.log(e),localStorage.clear(),"REFRESH_FAILURE"==e.response.data.code&&(location.href="/login"),Promise.reject(e)}))):Promise.reject(e)}));var m={name:"main-header",data:function(){return{profilePictureUrl:this.$store.getters.getProfilePictureUrl,keyword:""}},methods:{logout:function(){this.$store.dispatch("logout").then((function(e){console.log(e),location.href="/login"})).catch((function(e){console.log(e.response)}))},replaceByDefaultImg:function(e){e.target.src=r("6ff0")},goHome:function(){var e=this;this.$router.push({name:"Home"}).catch((function(t){console.log(t.name),"NavigationDuplicated"===t.name&&e.$router.go()}))},goChatRooms:function(){this.$router.push({name:"ChatRooms",params:{pKeyword:this.keyword},hash:Math.floor(100*Math.random())}).catch((function(e){console.log(e.name)}))}},computed:{checkProfilePictureUrl:function(){return this.$store.getters.getProfilePictureUrl}},watch:{checkProfilePictureUrl:function(e){this.profilePictureUrl=e}}},g=m,f=r("2877"),h=Object(f["a"])(g,i,n,!1,null,null,null),v=h.exports,b={name:"app",components:{"main-header":v}},y=b,w=(r("034f"),Object(f["a"])(y,s,o,!1,null,null,null)),x=w.exports,_=r("5f5b"),P=r("b1e0"),I=(r("ab8b"),r("2dd8"),r("2f62")),k=r("961e");a["default"].use(I["a"]);var C=new I["a"].Store({plugins:[Object(k["a"])()],state:{isLoggedin:!1,memberId:"",profilePictureUrl:""},mutations:{login_success:function(e,t){e.isLoggedin=!0,e.memberId=t.memberId,e.profilePictureUrl=t.profilePictureUrl},logout_success:function(e){e.isLoggedin=!1,e.memberId="",e.profilePictureUrl=""},changeProfilePicture:function(e,t){e.profilePictureUrl=t.profilePictureUrl}},actions:{login:function(e,t){var r=e.commit,a=t.memberId,s=t.password;return new Promise((function(e,t){d.login(a,s).then((function(t){d.getProfilePicture(a).then((function(e){r("login_success",{memberId:a,profilePictureUrl:e.data.src})})).catch((function(e){r("login_success",{memberId:a,profilePictureUrl:""})})),e(t)})).catch((function(e){console.log(e.response),t(e)}))}))},logout:function(e){var t=e.commit;return new Promise((function(e,r){d.logout().then((function(r){t("logout_success"),e(r)})).catch((function(e){r(e)}))}))},changeProfilePicture:function(e,t){var r=e.commit,a=t.profilePictureUrl;return new Promise((function(e,t){r("changeProfilePicture",{profilePictureUrl:a})}))}},getters:{isLoggedin:function(e){return e.isLoggedin},getMemberId:function(e){return e.memberId},getProfilePictureUrl:function(e){return e.profilePictureUrl}}}),S=r("8c4f"),E=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container",attrs:{id:"signup"}},[r("div",{staticStyle:{"text-align":"center"}},[r("div",{staticStyle:{display:"inline-block"}},[r("div",{staticClass:"card",staticStyle:{width:"22rem","border-radius":"20px"}},[r("div",{staticClass:"card-body"},[r("h4",{staticStyle:{"margin-bottom":"40px",opacity:"0.7"}},[e._v("회원 정보를 입력하세요.")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.memberId,expression:"memberId"}],staticClass:"signupInfo form-control",attrs:{type:"text",placeholder:"ID",required:"",autofocus:""},domProps:{value:e.memberId},on:{input:function(t){t.target.composing||(e.memberId=t.target.value)}}}),""!=e.memberIdErrorMessage?r("div",{staticClass:"signupErrorMessage"},[e._v(" "+e._s(e.memberIdErrorMessage)+" ")]):e._e(),r("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"signupInfo form-control",attrs:{type:"password",placeholder:"Password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),""!=e.passwordErrorMessage?r("div",{staticClass:"signupErrorMessage"},[e._v(" "+e._s(e.passwordErrorMessage)+" ")]):e._e(),r("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"signupInfo form-control",attrs:{type:"text",placeholder:"Name",required:""},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),""!=e.nameErrorMessage?r("div",{staticClass:"signupErrorMessage"},[e._v(" "+e._s(e.nameErrorMessage)+" ")]):e._e(),r("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"signupInfo form-control",attrs:{type:"text",placeholder:"Email",required:""},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),""!=e.emailErrorMessage?r("div",{staticClass:"signupErrorMessage"},[e._v(" "+e._s(e.emailErrorMessage)+" ")]):e._e(),r("button",{staticClass:"btn btn-lg btn-primary btn-block",on:{click:function(t){return e.signup()}}},[e._v("회원가입")])])])])])])},M=[],R={name:"signup",data:function(){return{memberId:"",password:"",name:"",email:"",memberIdErrorMessage:"",passwordErrorMessage:"",nameErrorMessage:"",emailErrorMessage:""}},methods:{signup:function(){var e=this;d.signup(this.memberId,this.password,this.name,this.email).then((function(e){alert("이메일 인증을 해주세요."),location.href="/login"})).catch((function(t){if(console.log("회원가입 실패"),e.memberIdErrorMessage="",e.passwordErrorMessage="",e.nameErrorMessage="",e.emailErrorMessage="","INVALID_INPUT_VALUE"===t.response.data.code)for(var r=t.response.data.errors,a=0;a<r.length;a++)"memberId"===r[a].field?e.memberIdErrorMessage=r[a].reason:"password"===r[a].field?e.passwordErrorMessage=r[a].reason:"name"===r[a].field?e.nameErrorMessage=r[a].reason:"email"===r[a].field&&(e.emailErrorMessage=r[a].reason);else"ACCOUNT_DUPLICATION"===t.response.data.code&&(e.memberIdErrorMessage=t.response.data.message)}))}}},U=R,D=(r("8d1b"),Object(f["a"])(U,E,M,!1,null,null,null)),T=D.exports,F=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container",attrs:{id:"login"}},[r("div",{staticStyle:{"text-align":"center"}},[r("div",{staticStyle:{display:"inline-block"}},[r("div",{staticClass:"card",staticStyle:{width:"22rem","border-radius":"20px"}},[r("div",{staticClass:"card-body"},[r("h4",{staticStyle:{"margin-bottom":"40px",opacity:"0.7"}},[e._v("로그인 정보를 입력하세요.")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.memberId,expression:"memberId"}],staticClass:"loginInfo form-control",attrs:{type:"text",placeholder:"ID",required:"",autofocus:""},domProps:{value:e.memberId},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login()},input:function(t){t.target.composing||(e.memberId=t.target.value)}}}),""!=e.memberIdErrorMessage?r("div",{staticClass:"loginErrorMessage"},[e._v(" "+e._s(e.memberIdErrorMessage)+" ")]):e._e(),r("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"loginInfo form-control",attrs:{type:"password",placeholder:"Password",required:""},domProps:{value:e.password},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login()},input:function(t){t.target.composing||(e.password=t.target.value)}}}),""!=e.passwordErrorMessage?r("div",{staticClass:"loginErrorMessage"},[e._v(" "+e._s(e.passwordErrorMessage)+" ")]):e._e(),r("button",{staticClass:"btn btn-lg btn-primary btn-block",on:{click:function(t){return e.login()}}},[e._v("로그인")])])])])])])},L=[],O={name:"login",data:function(){return{memberId:"",password:"",memberIdErrorMessage:"",passwordErrorMessage:""}},methods:{login:function(){var e=this;this.$store.dispatch("login",{memberId:this.memberId,password:this.password}).then((function(t){e.$router.push("/")})).catch((function(t){if(console.log(t.response),e.memberIdErrorMessage="",e.passwordErrorMessage="","INVALID_LOGIN_INPUT"===t.response.data.code)e.passwordErrorMessage=t.response.data.message;else if("INVALID_INPUT_VALUE"===t.response.data.code)for(var r=t.response.data.errors,a=0;a<r.length;a++)"memberId"===r[a].field?e.memberIdErrorMessage=r[a].reason:"password"===r[a].field&&(e.passwordErrorMessage=r[a].reason)}))}}},$=O,A=(r("039a"),Object(f["a"])($,F,L,!1,null,null,null)),N=A.exports,j=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container",attrs:{id:"profile"}},[r("div",{staticStyle:{"text-align":"center"}},[r("div",{staticStyle:{display:"inline-block"}},[r("div",{staticClass:"card",staticStyle:{width:"22rem","border-radius":"20px"}},[r("div",{staticClass:"card-body"},[r("div",{staticStyle:{"text-align":"left","margin-bottom":"20px"}},[r("input",{staticStyle:{display:"none"},attrs:{type:"file",name:"file",id:"profilePictureInput"},on:{change:e.previewProfilePicture}}),r("label",{attrs:{for:"profilePictureInput"}},[r("img",{attrs:{id:"profilePictureImg",src:e.profilePictureUrl,type:"button",width:"150",height:"150",alt:"프로필"},on:{error:e.replaceByDefaultImg}})]),r("span",{staticStyle:{"vertical-align":"top","margin-left":"15px"}},[""===e.profilePictureUrl?r("span",{staticStyle:{"font-weight":"100"},attrs:{type:"button"},on:{click:function(t){return e.registerProfilePicture()}}},[e._v("등록")]):r("span",[r("span",{staticStyle:{"font-weight":"100"},attrs:{type:"button"},on:{click:function(t){return e.deleteProfilePicture()}}},[e._v("삭제")])])])]),r("div",{staticStyle:{"text-align":"left"}},[r("div",{staticClass:"form-group"},[r("label",{staticStyle:{"font-weight":"550"},attrs:{for:"name"}},[e._v("이름")]),r("span",{staticClass:"form-control",attrs:{id:"name"}},[e._v(e._s(e.name))])]),r("div",{staticClass:"form-group"},[r("label",{staticStyle:{"font-weight":"550"},attrs:{for:"email"}},[e._v("이메일")]),r("span",{staticClass:"form-control",attrs:{id:"email"}},[e._v(e._s(e.email))])])])])])])])])},B=[],H=(r("fb6a"),r("159b"),{name:"profile",data:function(){return{name:"",email:"",profilePictureUrl:this.$store.getters.getProfilePictureUrl}},methods:{replaceByDefaultImg:function(e){e.target.src=r("6ff0")},previewProfilePicture:function(e){var t=e.target.files,r=Array.prototype.slice.call(t);0==r.length&&document.getElementById("profilePictureImg").setAttribute("src",""),r.forEach((function(e){if(!e.type.match("image.*"))return document.getElementById("profilePictureInput").value="",void alert("이미지 파일만 등록 가능합니다.");var t=new FileReader;t.onload=function(e){document.getElementById("profilePictureImg").setAttribute("src",e.target.result)},t.readAsDataURL(e)}))},registerProfilePicture:function(){var e=this,t=new FormData,r=document.getElementById("profilePictureInput");r.files.length>0?(t.append("file",r.files[0]),d.registerProfilePicture(t).then((function(t){e.$store.dispatch("changeProfilePicture",{profilePictureUrl:t.data.src})})).catch((function(e){console.log(e.response),"EXCEED_PROFILE_PICTURE"===e.response.data.code?alert(e.response.data.message):alert("사진 등록에 실패했습니다.")}))):alert("사진을 선택하세요.")},deleteProfilePicture:function(){var e=this;document.getElementById("profilePictureInput").value="",d.deleteProfilePicture().then((function(t){e.$store.dispatch("changeProfilePicture",{profilePictureUrl:""})})).catch((function(e){console.log(e.response)}))}},created:function(){var e=this;d.getMemberInfo(this.$store.getters.getMemberId).then((function(t){e.name=t.data.name,e.email=t.data.email})).catch((function(e){console.log(e.response)}))},computed:{checkProfilePictureUrl:function(){return this.$store.getters.getProfilePictureUrl}},watch:{checkProfilePictureUrl:function(e){this.profilePictureUrl=e}}}),z=H,V=Object(f["a"])(z,j,B,!1,null,null,null),W=V.exports,G=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container",attrs:{id:"chatRooms"}},[r("div",{staticStyle:{margin:"0 0 10px 10px",float:"left"}},[r("a",{attrs:{href:"#"},on:{click:function(t){return e.selectTotalRoom()}}},[r("span",{staticStyle:{"margin-right":"10px"}},[e._v("전체")])]),r("span",{staticStyle:{"margin-right":"10px"}},[e._v("/")]),r("a",{attrs:{href:"#"},on:{click:function(t){return e.selectParticipatingRoom()}}},[r("span",{staticStyle:{"margin-right":"10px"}},[e._v("참가중")])])]),r("div",{staticStyle:{float:"right","margin-right":"10px"}},[r("router-link",{attrs:{to:"/chat/rooms/creation"}},[r("span",[e._v("new chat")])])],1),r("div",{staticClass:"chatList",staticStyle:{clear:"both"}},["PARTICIPANT"===e.searchType?r("ul",{staticClass:"list-group",attrs:{id:"participatingRoom"}},e._l(e.rooms,(function(t){return r("li",{key:t.roomId,staticClass:"list-group-item list-group-item-action",on:{click:function(r){return e.enterRoom(t.roomId)}}},[r("span",{staticClass:"title",staticStyle:{float:"left","text-align":"left",width:"70%","font-weight":"500",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v(e._s(t.title))]),r("span",{staticClass:"lastMessageDate",staticStyle:{float:"right"}},[e._v(e._s(e.$moment(t.lastMessageDate).format("YYYY-MM-DD")))]),e._v(" "),r("br"),"IMAGE"===t.lastMessageType||"FILE"===t.lastMessageType?r("span",{staticClass:"lastMessage",staticStyle:{opacity:"0.7",float:"left","text-align":"left",width:"70%",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v("바이너리 파일입니다.")]):r("span",{staticClass:"lastMessage",staticStyle:{opacity:"0.7",float:"left","text-align":"left",width:"70%",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v(e._s(t.lastMessage))]),t.unreadMessageCount>0?r("span",{staticClass:"unreadMessageCount badge badge-danger badge-pill",staticStyle:{float:"right","margin-top":"5px"}},[e._v(e._s(t.unreadMessageCount))]):e._e()])})),0):r("ul",{staticClass:"list-group",attrs:{id:"totalRoom"}},e._l(e.rooms,(function(t){return r("li",{key:t.roomId,staticClass:"list-group-item list-group-item-action",staticStyle:{padding:"25px 20px 25px 20px"},on:{click:function(r){return e.enterRoom(t.roomId)}}},[r("span",{staticClass:"title",staticStyle:{float:"left","text-align":"left",width:"70%","font-weight":"500",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v(e._s(t.title))]),r("span",{staticClass:"lastMessageDate",staticStyle:{float:"right"}},[e._v(e._s(e.$moment(t.lastMessageDate).format("YYYY-MM-DD")))]),e._v(" "),r("br")])})),0),r("infinite-loading",{attrs:{spinner:"waveDots"},on:{infinite:e.infiniteHandler}},[r("div",{staticStyle:{color:"rgb(102, 102, 102)","font-size":"14px",padding:"10px 0px"},attrs:{slot:"no-more"},slot:"no-more"},[e._v("목록의 끝입니다.")])])],1)])},Y=[],q=r("e166"),X=r.n(q),J={name:"chatRooms",components:{InfiniteLoading:X.a},props:{pSearchType:{type:String,default:"TITLE"},pKeyword:{type:String,default:""}},data:function(){return{rooms:[],searchType:this.pSearchType,keyword:this.pKeyword,page:1,size:50,sortType:"TITLE",direction:"DESC",scrollState:Object}},methods:{enterRoom:function(e){this.$router.push({name:"ChatRoom",params:{roomId:e}})},selectTotalRoom:function(){this.searchType="TITLE",this.keyword="",this.page=1,this.sortType="TITLE",this.rooms=[],this.scrollState.reset()},selectParticipatingRoom:function(){this.searchType="PARTICIPANT",this.keyword="",this.page=1,this.sortType="MESSAGE",this.rooms=[],this.scrollState.reset()},infiniteHandler:function(e){var t=this;this.scrollState=e,d.searchRooms(this.searchType,this.keyword,this.page,this.size,this.sortType,this.direction).then((function(r){setTimeout((function(){r.data.rooms.length<t.size&&e.complete(),r.data.rooms.forEach((function(e){return t.rooms.push(e)})),e.loaded(),t.page+=1}),100)})).catch((function(e){console.error(e)}))}}},K=J,Z=Object(f["a"])(K,G,Y,!1,null,null,null),Q=Z.exports,ee=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"chatRoom"}},[r("b-container",[r("b-row",[r("b-col",{attrs:{cols:"6"}}),r("b-col",{staticStyle:{"text-align":"right",padding:"0"},attrs:{cols:"6"}},[r("a",{attrs:{href:"#"},on:{click:e.leaveRoom}},[r("span",{staticStyle:{"padding-right":"5px"}},[e._v("나가기")])])])],1),r("b-row",[r("b-col",{staticStyle:{padding:"0",border:"1px solid","border-right-style":"none"},attrs:{cols:"4"}},[r("div",{staticClass:"overflow-auto",staticStyle:{height:"60vh"}},e._l(e.chatParticipants,(function(t){return r("div",{key:t.participantId},[r("b-list-group-item",{staticClass:"d-flex align-items-center"},[r("b-avatar",{staticClass:"mr-3",attrs:{src:t.profilePictureUrl}}),r("span",{staticStyle:{"font-size":"16px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v(e._s(t.participantName))])],1)],1)})),0)]),r("b-col",{staticStyle:{border:"1px solid"},attrs:{cols:"8"}},[r("b-row",[r("b-col",{staticStyle:{padding:"0"}},[r("div",{ref:"messageWindow",staticStyle:{height:"60vh","overflow-x":"hidden","word-wrap":"break-word","word-break":"break-all"},attrs:{id:"messageWindow"}},[r("infinite-loading",{attrs:{direction:"top"},on:{infinite:e.messageInfiniteHandler}},[r("div",{staticStyle:{color:"rgb(102, 102, 102)","font-size":"14px",padding:"10px 0px"},attrs:{slot:"no-more"},slot:"no-more"})]),e._l(e.messages,(function(t){return r("div",{key:t.messageId},["ENTER"===t.type||"LEAVE"===t.type?r("div",{staticStyle:{"text-align":"center",width:"100%","margin-bottom":"10px"}},[r("div",{staticClass:"myMessage",staticStyle:{"max-width":"70%",display:"inline-block","background-color":"#F0F8FF","border-radius":"25px",padding:"10px"}},[r("span",[e._v(e._s(t.message))])])]):t.sender===e.$store.getters.getMemberId?r("div",{staticClass:"right",staticStyle:{"text-align":"right","margin-bottom":"5px"}},[r("div",{staticStyle:{display:"inline-block",width:"100%"}},[r("b-list-group-item",{staticClass:"d-flex align-items-top",staticStyle:{border:"0",padding:"10px 20px 0 0"}},["TEXT"===t.type?r("div",{staticStyle:{width:"100%"}},[r("div",{staticClass:"messageDate",staticStyle:{"vertical-align":"bottom",display:"inline-block"}},[r("span",[r("small",[e._v(e._s(t.createdDate))])])]),r("div",{staticClass:"myMessage",staticStyle:{"max-width":"70%",display:"inline-block","text-align":"left","background-color":"#00BFFF","border-radius":"15px",padding:"10px"}},[r("span",[e._v(e._s(t.message))])])]):"IMAGE"===t.type?r("div",{staticStyle:{width:"100%"}},[r("div",{staticClass:"messageDate",staticStyle:{"vertical-align":"bottom",display:"inline-block"}},[r("span",[r("small",[e._v(e._s(t.createdDate))])])]),r("div",{staticClass:"myMessage",staticStyle:{"max-width":"70%",display:"inline-block"}},[r("a",{attrs:{href:t.attachUrl}},[r("img",{staticStyle:{height:"150px","border-radius":"10px"},attrs:{src:t.attachUrl}})])])]):"FILE"===t.type?r("div",{staticStyle:{width:"100%"}},[r("div",{staticClass:"messageDate",staticStyle:{"vertical-align":"bottom",display:"inline-block"}},[r("span",[r("small",[e._v(e._s(t.createdDate))])])]),r("a",{staticStyle:{color:"black"},attrs:{href:t.attachUrl,download:""}},[r("div",{staticStyle:{width:"200px",height:"50px","border-radius":"10px","background-color":"#DCDCDC",padding:"12px",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","text-align":"left"}},[r("b-icon",{staticStyle:{"margin-right":"10px"},attrs:{icon:"file-text-fill",scale:"1.5"}}),e._v(" "+e._s(e.getFileName(t.attachUrl))+" ")],1)])]):e._e()])],1)]):r("div",{staticClass:"left"},[r("b-list-group-item",{staticClass:"d-flex align-items-top",staticStyle:{border:"0",padding:"10px 0 0 20px","margin-bottom":"5px"}},[e.chatParticipants.find((function(e){return e.participantId===t.sender}))?r("b-avatar",{staticClass:"mr-2",attrs:{src:e.chatParticipants.find((function(e){return e.participantId===t.sender})).profilePictureUrl}}):r("b-avatar",{staticClass:"mr-2"}),"TEXT"===t.type?r("div",{staticStyle:{"text-align":"left",width:"100%"}},[r("div",{staticClass:"participantName"},[r("span",[e._v(e._s(t.name))])]),r("div",{staticClass:"otherMessage",staticStyle:{display:"inline-block","background-color":"#DCDCDC","border-radius":"15px",padding:"10px","max-width":"70%"}},[r("span",[e._v(e._s(t.message))])]),r("div",{staticClass:"messageDate",staticStyle:{"vertical-align":"bottom",display:"inline-block"}},[r("span",[r("small",[e._v(e._s(t.createdDate))])])])]):"IMAGE"===t.type?r("div",[r("div",{staticClass:"otherMessage",staticStyle:{"max-width":"70%",display:"inline-block"}},[r("a",{attrs:{href:t.attachUrl}},[r("img",{staticStyle:{height:"150px","border-radius":"10px"},attrs:{src:t.attachUrl}})])]),r("div",{staticClass:"messageDate",staticStyle:{"vertical-align":"bottom",display:"inline-block"}},[r("span",[r("small",[e._v(e._s(t.createdDate))])])])]):"FILE"===t.type?r("div",[r("a",{staticStyle:{color:"black"},attrs:{href:t.attachUrl,download:""}},[r("div",{staticStyle:{width:"200px",height:"50px","border-radius":"10px","background-color":"#DCDCDC",padding:"12px",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","text-align":"left"}},[r("b-icon",{staticStyle:{"margin-right":"10px"},attrs:{icon:"file-text-fill",scale:"1.5"}}),e._v(" "+e._s(e.getFileName(t.attachUrl))+" ")],1)]),r("div",{staticClass:"messageDate",staticStyle:{"vertical-align":"bottom",display:"inline-block"}},[r("span",[r("small",[e._v(e._s(t.createdDate))])])])]):e._e()],1)],1)])}))],2)])],1),r("b-row",[r("b-col",{staticStyle:{padding:"0"}},[r("div",{staticStyle:{"text-align":"left","overflow-y":"hidden","overflow-x":"auto","white-space":"nowrap","background-color":"#F8F8FF"}},e._l(e.uploadFiles,(function(t,a){return r("div",{key:a,staticStyle:{display:"inline-block",position:"relative","margin-top":"10px",padding:"5px"}},[t.type.startsWith("image")?r("div",{staticStyle:{width:"50px",height:"50px",overflow:"hidden"}},[r("img",{staticStyle:{width:"100%",height:"100%","border-radius":"10px"},attrs:{src:t.previewUrl}})]):r("div",{staticStyle:{width:"200px",height:"50px","border-radius":"10px","background-color":"#DCDCDC",padding:"12px",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[r("b-icon",{staticStyle:{"margin-right":"10px"},attrs:{icon:"file-text-fill",scale:"1.5"}}),r("span",[e._v(e._s(t.name))])],1),r("div",{staticStyle:{position:"absolute",top:"-3px",right:"-3px","background-color":"#666666",width:"20px",height:"20px",color:"white","text-align":"center","font-weight":"bold"},attrs:{type:"button"},on:{click:function(t){return e.deleteUploadFile(a)}}},[e._v("x")])])})),0),r("div",{staticClass:"input-group"},[r("div",{staticClass:"input-group-prepend"},[r("label",{staticClass:"input-group-text",attrs:{for:"uploadFileInput",type:"button"}},[r("b-icon",{attrs:{id:"uploadFileIcon",icon:"upload","aria-hidden":"true"}})],1),r("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"uploadFileInput",multiple:""},on:{change:e.addUploadFilesAndPreviewUrl}})]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.textMessage,expression:"textMessage"}],staticClass:"form-control",attrs:{type:"input"},domProps:{value:e.textMessage},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage("TEXT")},input:function(t){t.target.composing||(e.textMessage=t.target.value)}}}),r("div",{staticClass:"input-group-append"},[r("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(t){return e.sendMessage()}}},[e._v("보내기")])])])])],1)],1)],1)],1)],1)},te=[],re=r("1da1"),ae=(r("96cf"),r("7db0"),r("a434"),r("2ca0"),r("1276"),r("c6e1")),se=r.n(ae),oe=r("cc7d"),ie=r.n(oe),ne={name:"chatRoom",components:{InfiniteLoading:X.a},data:function(){return{roomId:this.$route.params.roomId,chatParticipants:[],messages:[],textMessage:"",sock:Object,stompClient:Object,isSubscribe:!1,uploadFiles:[],fileUrls:Array}},methods:{connectStomp:function(){var e=this;return new Promise((function(t,r){e.sock=new ie.a("/ws"),e.stompClient=se.a.over(e.sock),e.stompClient.connect({Authorization:"Bearer "+d.getCookieValue("access_token")},(function(r){return e.subscribeChatRoom(e.stompClient),t(e.stompClient)}),function(){var r=Object(re["a"])(regeneratorRuntime.mark((function r(a){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(console.log(a),e.isSubscribe=!1,"UNAUTHORIZED"!==a.reason){r.next=7;break}return r.next=5,d.refresh().then((function(e){console.log("WS connect 리프레시 성공")})).catch((function(e){console.log(e),alert("WS connect 리프레시 실패"),localStorage.clear(),location.href="/login"}));case 5:r.next=9;break;case 7:if("LEAVE"!==a.reason){r.next=9;break}return r.abrupt("return",null);case 9:return r.abrupt("return",t(e.connectStomp()));case 10:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}))},subscribeChatRoom:function(e){var t=this;return e.subscribe("/topic/v1/chat/rooms/"+this.roomId,function(){var e=Object(re["a"])(regeneratorRuntime.mark((function e(r){var a,s,o,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r.body){e.next=28;break}if(a=JSON.parse(r.body),"SUBSCRIBE"!==a.type){e.next=26;break}if(a.sender!==t.$store.getters.getMemberId){e.next=24;break}return t.isSubscribe=!0,t.getParticipants(),e.next=8,d.getLastReadMessage(t.roomId);case 8:return s=e.sent,o=null,s.data.messages.length>0&&(o=s.data.messages[0].createdDate),e.next=13,d.getMessages(t.roomId,o,"GOEDATE",null);case 13:i=e.sent,i=i.data.messages,n=0;case 16:if(!(n<i.length)){e.next=23;break}if(!t.messages.find((function(e){return e.createdDate===i[n].createdDate}))){e.next=19;break}return e.abrupt("continue",20);case 19:t.messages.push(i[n]);case 20:n++,e.next=16;break;case 23:t.messages.sort(t.compareMessageDate);case 24:e.next=28;break;case 26:t.recvMessage(a),"ENTER"!==a.type&&"LEAVE"!==a.type||t.getParticipants();case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{Authorization:"Bearer "+d.getCookieValue("access_token"),type:"chatRoom"})},disconnectStomp:function(){this.stompClient.disconnect()},recvMessage:function(e){this.messages.push(e)},messageInfiniteHandler:function(e){var t=this;if(this.isSubscribe){var r=void 0;this.messages[0]&&(r=this.messages[0].createdDate);var a,s="LOEDATE",o=10;d.getMessages(this.roomId,null,"GOEDATE",1).then((function(e){a=e.data.messages[0].messageId})),d.getMessages(this.roomId,r,s,o).then((function(r){setTimeout((function(){if(r.data.messages.length){for(var s=r.data.messages,o=0;o<s.length;o++)t.messages.find((function(e){return e.createdDate===s[o].createdDate}))||t.messages.push(s[o]);t.messages.sort(t.compareMessageDate),e.loaded()}a===r.data.messages[0].messageId&&e.complete()}),100)}))}else setTimeout((function(){e.reset()}),500)},compareMessageDate:function(e,t){var r=new Date(e.createdDate),a=new Date(t.createdDate);return r>=a?1:-1},getParticipants:function(){var e=this;d.getParticipants(this.roomId).then((function(t){e.chatParticipants=t.data.participants.slice()})).catch((function(e){console.log(e)}))},existsParticipant:function(){return d.existsParticipant(this.roomId)},addUploadFilesAndPreviewUrl:function(e){for(var t=Array.prototype.slice.call(e.target.files),r=0;r<t.length;r++){var a=this.makePreviewUrl(t[r]);this.uploadFiles.push(a)}console.log(this.uploadFiles),e.target.value=""},makePreviewUrl:function(e){var t=window.URL.createObjectURL(e);return e.previewUrl=t,e},deleteUploadFile:function(e){this.uploadFiles.splice(e,1)},sendMessage:function(){var e=this;""!==this.textMessage.replace(/\s/g,"")&&(d.sendMessage(this.roomId,"TEXT",this.textMessage).then((function(e){})).catch((function(e){console.log(e)})),this.textMessage="");for(var t=function(){var t=void 0;t=e.uploadFiles[r].type.startsWith("image")?"IMAGE":"FILE",e.uploadFile(e.uploadFiles[r]).then((function(r){d.sendMessage(e.roomId,t,r.data.url)})).catch((function(e){console.log(e)}))},r=0;r<this.uploadFiles.length;r++)t();this.uploadFiles.splice(0,this.uploadFiles.length)},uploadFile:function(e){var t=new FormData;return console.log(e),t.append("uploadFile",e),t.append("roomId",this.roomId),d.uploadFile(t)},getFileName:function(e){var t=e.split("/"),r=t.length,a=t[r-1].split("?")[0];return a},leaveRoom:function(){var e=this;d.leaveRoom(this.roomId).then((function(t){e.stompClient.disconnect(),e.$router.push({name:"Home"})})).catch((function(e){console.log(e.response)}))}},created:function(){var e=Object(re["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.connectStomp(this);case 2:this.stompClient=e.sent,console.log(this.stompClient);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),mounted:function(){window.addEventListener("beforeunload",this.disconnectStomp)},beforeUnmount:function(){window.removeEventListener("beforeunload",this.disconnectStomp)},beforeDestroy:function(){this.disconnectStomp()},watch:{messages:function(e){var t=this;return Object(re["a"])(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.$refs.messageWindow.offsetHeight,a=t.$refs.messageWindow.scrollTop,s=t.$refs.messageWindow.scrollHeight,e.next=5,t.$nextTick();case 5:r+a+200>=s&&(t.$refs.messageWindow.scrollTop=t.$refs.messageWindow.scrollHeight);case 6:case"end":return e.stop()}}),e)})))()}}},le=ne,ce=Object(f["a"])(le,ee,te,!1,null,null,null),ue=ce.exports,de=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container",attrs:{id:"chatRoomCreation"}},[e._m(0),r("input",{directives:[{name:"model",rawName:"v-model",value:e.roomTitle,expression:"roomTitle"}],attrs:{id:"roomTitle",type:"text"},domProps:{value:e.roomTitle},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.createRoom(t)},input:function(t){t.target.composing||(e.roomTitle=t.target.value)}}}),r("button",{staticClass:"btn btn-primary mb-2",on:{click:e.createRoom}},[e._v("만들기")])])},pe=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{"margin-bottom":"50px",opacity:"0.7"}},[r("h4",[e._v("채팅방 이름을 입력하세요.")])])}],me={name:"chatRoomCreation",data:function(){return{roomTitle:""}},methods:{createRoom:function(){console.log(this.roomTitle),d.createRoom(this.roomTitle).then((function(e){d.enterRoom(e.data.roomId)})).catch((function(e){console.log("채팅방 개설에 실패했습니다."),console.log(e.response)}))}}},ge=me,fe=(r("e5a7"),Object(f["a"])(ge,de,pe,!1,null,null,null)),he=fe.exports;a["default"].use(S["a"]);var ve=new S["a"]({mode:"history",routes:[{path:"/",component:Q,name:"Home"},{path:"/signup",component:T},{path:"/login",component:N},{path:"/profile",component:W},{path:"/chat/rooms",component:Q,name:"ChatRooms",props:!0},{path:"/chat/rooms/creation",component:he},{path:"/chat/rooms/:roomId",component:ue,name:"ChatRoom"},{path:"*",redirect:"/"}]}),be=ve,ye=r("13a4"),we=r.n(ye);a["default"].prototype.$axios=c.a,a["default"].use(_["a"]),a["default"].use(P["a"]),a["default"].use(we.a),a["default"].config.productionTip=!1;var xe=new a["default"];new a["default"]({router:be,store:C,render:function(e){return e(x)},data:{},methods:{}}).$mount("#app")},"6ff0":function(e,t,r){e.exports=r.p+"img/defaultProfilePicture.9acfe78b.png"},7174:function(e,t,r){},"85ec":function(e,t,r){},"8d1b":function(e,t,r){"use strict";r("2dad")},be1f:function(e,t,r){},e5a7:function(e,t,r){"use strict";r("be1f")}});
//# sourceMappingURL=app.db56ab18.js.map